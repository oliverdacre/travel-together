{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>âœˆï¸ {{ proposal.title }}</h1>
  <p class="text-muted">ğŸ‘¤ Created by <a href="{{ url_for('profile.profile', user_id=proposal.creator_id) }}">{{ proposal.creator.name }}</a></p>
</div>

<div class="card">
  <h2>ğŸ“‹ Details</h2>

<p><strong>ğŸ“{{ 'ğŸ”’' if proposal.description_final else 'ğŸ”“' }} Description:</strong><br>
  {{ proposal.description or "No description provided." }}
</p>

<p><strong>ğŸ“{{ 'ğŸ”’' if proposal.destination_final else 'ğŸ”“' }} Destination:</strong> {{ proposal.destination or "Not specified" }}</p>

{% if proposal.budget %}
  <p><strong>ğŸ’°{{ 'ğŸ”’' if proposal.budget_final else 'ğŸ”“' }} Budget:</strong> {{ proposal.budget }} EUR</p>
{% endif %}

{% if proposal.departure_locations %}
  <p><strong>ğŸš‚{{ 'ğŸ”’' if proposal.departure_locations_final else 'ğŸ”“' }} Departure locations:</strong> {{ proposal.departure_locations }}</p>
{% endif %}

{% if proposal.activities %}
  <p><strong>ğŸ¯{{ 'ğŸ”’' if proposal.activities_final else 'ğŸ”“' }} Planned activities:</strong> {{ proposal.activities }}</p>
{% endif %}

<p><strong>ğŸ“…{{ 'ğŸ”’' if proposal.start_date_final else 'ğŸ”“' }} Start date:</strong> {{ proposal.start_date.strftime('%Y-%m-%d') }}</p>
<p><strong>ğŸ“…{{ 'ğŸ”’' if proposal.end_date_final else 'ğŸ”“' }} End date:</strong> {{ proposal.end_date.strftime('%Y-%m-%d') }}</p>
<p><strong>ğŸ‘¥{{ 'ğŸ”’' if proposal.max_participants_final else 'ğŸ”“' }} Max participants:</strong> {{ proposal.max_participants }}</p>
<p><strong>ğŸ“Š Status:</strong> {{ proposal.status.value }}</p>

</div>

{% if is_participant %}
  <div class="card">
    <h2>ğŸ‘¥ Participants</h2>
  {% if participants %}
    <ul>
      {% for p in participants %}
        <li>
          <a href="{{ url_for('profile.profile', user_id=p.user.id) }}">{{ p.user.name }}</a>
          (joined {{ p.joined_at.strftime('%Y-%m-%d %H:%M') }})
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">ğŸ‘‹ No participants yet.</p>
  {% endif %}
  </div>
{% else %}
  <div class="card">
    <form action="{{ url_for('trip.join_trip', trip_id=proposal.id) }}" method="post">
      <button type="submit" class="btn btn-primary">âœ… Join trip</button>
    </form>
  </div>
{% endif %}

{% if is_participant %}
<div class="card">
  <h2>ğŸ’¬ Discussion</h2>
  <p>
    <a href="{{ url_for('main.message_board', trip_id=proposal.id) }}" class="btn btn-secondary">
      ğŸ’¬ Go to message board â†’
    </a>
  </p>
</div>
{% endif %}

{% if is_participant %}
{% include 'trip/meetups.html' %}
{% endif %}


{% if is_participant %}
{% include 'trip/gallery.html' %}
{% endif %}


{% if is_participant %}
<div class="card">
  <h2>â­ Participant Ratings</h2>

  {% if proposal.end_date < current_time %}
      <p>
        <a href="{{ url_for('trip.rate_users', trip_id=proposal.id) }}" class="btn btn-primary">
          â­ Rate participants â†’
        </a>
      </p>
  {% else %}
      <p class="text-muted">
        Ratings will be available after the trip ends on {{ proposal.end_date.strftime('%Y-%m-%d') }}.
      </p>
  {% endif %}
</div>
{% endif %}


{% if current_user in proposal.editors %}
  {% include 'trip/editor_tools.html' %}
{% endif %}

<div class="mt-md flex-between">
  <a href="{{ url_for('trip.list_all') }}" class="btn btn-link">â† Back to all trip proposals</a>
  {% if is_participant %}
  <a href="{{ url_for('trip.leave_trip', trip_id=proposal.id) }}" class="btn btn-danger">ğŸšª Leave trip</a>
  {% endif %}
</div>
{% endblock %}
