{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1>âœˆï¸ {{ proposal.title }}</h1>
  <p class="text-muted">ğŸ‘¤ Created by <a href="{{ url_for('profile.profile', user_id=proposal.creator_id) }}">{{ proposal.creator.name }}</a></p>
</div>

<div class="card">
  <h2>ğŸ“‹ Details</h2>

<p><strong>ğŸ“ Description:</strong><br>
  {{ proposal.description or "No description provided." }}
</p>

<p><strong>ğŸ“ Destination:</strong> {{ proposal.destination or "Not specified" }}</p>

{% if proposal.budget %}
  <p><strong>ğŸ’° Budget:</strong> {{ proposal.budget }} EUR</p>
{% endif %}

{% if proposal.departure_locations %}
  <p><strong>ğŸš‚ Departure locations:</strong> {{ proposal.departure_locations }}</p>
{% endif %}

{% if proposal.activities %}
  <p><strong>ğŸ¯ Planned activities:</strong> {{ proposal.activities }}</p>
{% endif %}

<p><strong>ğŸ“… Start date:</strong> {{ proposal.start_date.strftime('%Y-%m-%d') }}</p>
<p><strong>ğŸ“… End date:</strong> {{ proposal.end_date.strftime('%Y-%m-%d') }}</p>

<p><strong>ğŸ‘¥ Max participants:</strong> {{ proposal.max_participants }}</p>
<p><strong>ğŸ“Š Status:</strong> {{ proposal.status.name }}</p>

</div>

{% if is_participant %}
  <div class="card">
    <h2>ğŸ‘¥ Participants</h2>
  {% if participants %}
    <ul>
      {% for p in participants %}
        <li>
          <a href="{{ url_for('profile.profile', user_id=p.user.id) }}">{{ p.user.name }}</a>
          (joined {{ p.joined_at.strftime('%Y-%m-%d %H:%M') }})
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">ğŸ‘‹ No participants yet.</p>
  {% endif %}
  </div>
{% else %}
  <div class="card">
    <form action="{{ url_for('trip.join_trip', trip_id=proposal.id) }}" method="post">
      <button type="submit" class="btn btn-primary">âœ… Join trip</button>
    </form>
  </div>
{% endif %}

{% if is_participant %}
<div class="card">
  <h2>ğŸ’¬ Discussion</h2>
  <p>
    <a href="{{ url_for('main.message_board', trip_id=proposal.id) }}" class="btn btn-secondary">
      ğŸ’¬ Go to message board â†’
    </a>
  </p>
</div>
{% endif %}

{% if current_user in proposal.editors %}
<div class="card">

  <h2>ğŸ› ï¸ Editor Tools</h2> 

  <br>
  
  <div>
    <a href="{{ url_for('trip.edit_trip', trip_id=proposal.id) }}" class ="btn btn-primary">
      âœï¸ Edit
    </a>
  </div>

  <br>

  <div>

    <form action="{{ url_for('trip.add_editor', trip_id=proposal.id) }}" method="POST">

      <div class="form-group">
        <select name="user_id" required>
          <option value="" disabled selected>Select participantâ€¦</option>
          {% for participant in proposal.participants %}
            {% if not participant.is_editor %}
              <option value="{{ participant.user.id }}">
                {{ participant.user.name }} ({{ participant.user.email }})
              </option>
            {% endif %}
          {% endfor %}
        </select>
      </div>

      <button class="btn btn-primary">â• Add editor</button>
    </form>
  </div>

</div>
{% endif %}


<p class="mt-md">
  <a href="{{ url_for('trip.list_all') }}" class="btn btn-link">â† Back to all trip proposals</a>
</p>
{% endblock %}
